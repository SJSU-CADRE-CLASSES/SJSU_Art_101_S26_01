<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your estimate — Art 101 Project 1</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      font-family: 'Barlow', system-ui, sans-serif;
      background: linear-gradient(160deg, #FFF0F5 0%, #E8F4F8 45%, #F0E6FA 100%);
      color: #3d3d5c;
    }
    h1 {
      font-size: 1.75rem;
      font-weight: 600;
      margin: 0 0 2rem 0;
      color: #5a4a6a;
    }
    .viz {
      width: 100%;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .card {
      background: rgba(255,255,255,0.8);
      border: 2px solid rgba(199, 206, 234, 0.4);
      border-radius: 20px;
      padding: 1.5rem 1.75rem;
      box-shadow: 0 8px 28px rgba(181, 234, 215, 0.2);
    }
    .card h2 {
      font-size: 1rem;
      font-weight: 600;
      color: #5a4a6a;
      margin: 0 0 1rem 0;
    }
    .big-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: #C7CEEA;
      margin: 0 0 0.5rem 0;
      text-shadow: 0 1px 2px rgba(0,0,0,0.06);
    }
    .big-number.sub {
      font-size: 1.25rem;
      font-weight: 600;
      color: #6b5b7a;
    }
    .bar-wrap {
      margin-top: 0.75rem;
    }
    .bar-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.6rem;
    }
    .bar-row:last-child { margin-bottom: 0; }
    .bar-label {
      flex: 0 0 120px;
      font-size: 0.9rem;
      color: #3d3d5c;
    }
    .bar-track {
      flex: 1;
      height: 26px;
      background: rgba(199, 206, 234, 0.25);
      border-radius: 10px;
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.6s ease;
    }
    .bar-value {
      flex: 0 0 60px;
      font-size: 0.9rem;
      font-weight: 600;
      text-align: right;
      color: #5a4a6a;
    }
    .summary {
      font-size: 0.9rem;
      color: #6b5b7a;
      margin-top: 1rem;
    }
    a.back {
      display: inline-block;
      margin-top: 2rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: #6b5b7a;
      text-decoration: none;
      padding: 0.5rem 1rem;
      background: rgba(255,255,255,0.8);
      border-radius: 12px;
      border: 1px solid rgba(199, 206, 234, 0.5);
    }
    a.back:hover {
      color: #5a4a6a;
      background: #fff;
      box-shadow: 0 4px 12px rgba(199, 206, 234, 0.3);
    }
  </style>
</head>
<body>
  <h1>Your estimated cost</h1>
  <div class="viz" id="viz"></div>
  <a href="unbox-more.html" class="back">← Back to questionnaire</a>
  <script>
    (function() {
      function spendKey(seriesName) {
        return 'spend_' + seriesName.replace(/\s+/g, '_');
      }

      var params = new URLSearchParams(window.location.search);
      var frequency = parseInt(params.get('frequency'), 10) || 1;
      var series = params.getAll('series');
      if (series.length === 0) series = ['No series selected'];

      var seriesWithPrices = [];
      var totalSpent = 0;
      var maxPrice = 0;
      for (var s = 0; s < series.length; s++) {
        var name = series[s];
        var key = spendKey(name);
        var p = parseFloat(params.get(key), 10);
        if (isNaN(p) || p < 0) p = 0;
        seriesWithPrices.push({ name: name, price: p });
        totalSpent += p;
        if (p > maxPrice) maxPrice = p;
      }
      var avgPrice = seriesWithPrices.length ? (totalSpent / seriesWithPrices.length) : 0;
      var estimatedMonthly = Math.round(frequency * avgPrice * 10) / 10;
      var estimatedAnnual = Math.round(estimatedMonthly * 12 * 10) / 10;
      if (maxPrice === 0) maxPrice = 1;

      var colors = ['#FFB5C2', '#B5EAD7', '#C7CEEA', '#FFDAC1', '#A8D8EA'];
      var maxBar = Math.max(estimatedAnnual, estimatedMonthly, 1);

      var html = '';

      html += '<div class="card">';
      html += '<h2>Estimated monthly cost</h2>';
      html += '<p class="big-number">$' + estimatedMonthly + '</p>';
      html += '<p class="big-number sub">' + frequency + ' box(es) per month × avg $' + avgPrice.toFixed(2) + '/box from your series</p>';
      html += '<div class="bar-wrap"><div class="bar-row">';
      html += '<span class="bar-label">Est. monthly</span>';
      html += '<div class="bar-track"><div class="bar-fill" style="width:' + (estimatedMonthly / maxBar * 100) + '%;background:#C7CEEA"></div></div>';
      html += '<span class="bar-value">$' + estimatedMonthly + '</span></div></div>';
      html += '</div>';

      html += '<div class="card">';
      html += '<h2>Estimated annual spend</h2>';
      html += '<p class="big-number">$' + estimatedAnnual + '</p>';
      html += '<div class="bar-wrap"><div class="bar-row">';
      html += '<span class="bar-label">Year total</span>';
      html += '<div class="bar-track"><div class="bar-fill" style="width:' + (estimatedAnnual / maxBar * 100) + '%;background:#B5EAD7"></div></div>';
      html += '<span class="bar-value">$' + estimatedAnnual + '</span></div></div>';
      html += '<p class="summary">$' + estimatedMonthly + '/month × 12 months</p>';
      html += '</div>';

      if (seriesWithPrices.length) {
        html += '<div class="card">';
        html += '<h2>Money spent per box (your entries)</h2>';
        html += '<div class="bar-wrap">';
        for (var i = 0; i < seriesWithPrices.length; i++) {
          var item = seriesWithPrices[i];
          var c = colors[i % colors.length];
          var pct = maxPrice > 0 ? (item.price / maxPrice * 100) : 0;
          html += '<div class="bar-row">';
          html += '<span class="bar-label">' + item.name + '</span>';
          html += '<div class="bar-track"><div class="bar-fill" style="width:' + pct + '%;background:' + c + '"></div></div>';
          html += '<span class="bar-value">$' + item.price + '</span></div>';
        }
        html += '</div></div>';
      }

      document.getElementById('viz').innerHTML = html;
    })();
  </script>
</body>
</html>
