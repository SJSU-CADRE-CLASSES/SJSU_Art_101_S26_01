<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>DIGITAL RESIDUE — Visualization</title>
<link rel="stylesheet" href="./style.css?v=1016">

<style>

/* =========================
   EXISTING BLOBS — unchanged
   ========================= */

#blob-stage{
  position:relative;
  isolation:isolate;
}

.blob-wrap{
  position:absolute;
  left:0;top:0;
  will-change:transform;
  touch-action:manipulation;
  z-index:10;
}

.blob-core{
  width:100%;
  height:100%;
  border-radius:50%;
  opacity:.88;
  filter:blur(10px) saturate(2.4);
  pointer-events:none;
  position:relative;
  transition:
    filter 180ms ease,
    opacity 180ms ease;
}

/* ⭐️ SLOWER BLACK MIX — THIS IS NEW */
.blob-core::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:50%;
  background:#000;
  opacity:0;
  transition:opacity 2600ms cubic-bezier(.22,1,.36,1);
}

.blob-core.to-black::before{
  opacity:1;
}

/* =========================
   COMBINE BUTTON
   ========================= */

#combine-btn{
  position:fixed;
  left:50%;
  top:230px;
  transform:translateX(-50%);
  z-index:9999;

  letter-spacing:10px;
  padding:10px 18px;
  border-radius:999px;
  border:1px solid rgba(17,17,17,.22);
  background:rgba(255,255,255,.35);
  color:rgba(17,17,17,.55);

  opacity:0;
  pointer-events:none;
  transition:opacity 900ms ease;
}

#combine-btn.show{
  opacity:.55;
  pointer-events:auto;
}

/* =========================
   MEGA BLACK BLOB
   ========================= */

#mega-blob{
  position:fixed;
  left:50%;
  top:50%;
  width:62vmin;
  height:62vmin;
  transform:translate(-50%,-50%) scale(.001);
  border-radius:50%;
  pointer-events:none;

  background:#000;

  /* ⭐️ MATCH OTHER BLOBS */
  filter:blur(10px);

  opacity:0;
  z-index:999998;

  /* ⭐️ SUPER SLOW CINEMATIC GROWTH */
  transition:
    transform 5200ms cubic-bezier(.12,1,.18,1),
    opacity 1600ms ease;
}

#mega-blob.on{
  opacity:1;
}

/* =========================
   FULL BLACK SCREEN
   ========================= */

#combine-overlay{
  position:fixed;
  inset:0;
  z-index:999999;
  opacity:0;
  pointer-events:none;
  transition:opacity 1400ms ease;
}

#combine-overlay.on{
  opacity:1;
  pointer-events:auto;
}

#combine-overlay .veil{
  position:absolute;
  inset:0;
  background:#000; /* pure black screen */
}

/* README PANEL */
#combine-overlay .panel{
  position:absolute;
  left:50%;
  top:52%;
  transform:translate(-50%,-50%);
  width:min(860px,calc(100vw - 80px));
  padding:28px 26px;
  border-radius:18px;
  background:rgba(0,0,0,.55);
  color:#fff;
}

</style>
</head>

<body data-page="viz">

<audio id="bg-music" loop preload="none" playsinline>
<source src="./ice-background.mp3" type="audio/mpeg">
</audio>

<button id="combine-btn">COMBINE</button>
<div id="blob-stage"></div>
<div id="mega-blob"></div>

<div id="combine-overlay">
  <div class="veil"></div>
  <div class="panel">
    <h2>READ ME</h2>
    <p>Replace with your final concept text.</p>
  </div>
</div>

<script src="./data.js?v=1016"></script>

<script>
(() => {

const stage=document.getElementById("blob-stage");
const mega=document.getElementById("mega-blob");
const overlay=document.getElementById("combine-overlay");
const combineBtn=document.getElementById("combine-btn");

const ITEMS=(typeof APPS!=="undefined")?APPS:[];

const combineState={active:false,phase:0,start:0};

/* =========================
   SAFE — ONLY COMBINE LOGIC CHANGED
   ========================= */

function computeMegaFillScale(){
  const w=window.innerWidth;
  const h=window.innerHeight;
  const baseR=Math.max(mega.offsetWidth,1)*.5;
  const cornerDist=Math.hypot(w*.5,h*.5);
  return (cornerDist/baseR)*3.4; // ⭐️ stronger full-screen fill
}

function expandMegaToFill(onDone){

  mega.classList.add("on");

  mega.style.transform=
    "translate(-50%,-50%) scale(.04)";

  requestAnimationFrame(()=>{
    requestAnimationFrame(()=>{
      mega.style.transform=
        `translate(-50%,-50%) scale(${computeMegaFillScale()})`;
    });
  });

  setTimeout(()=>{
    onDone&&onDone();
  },5400); // ⭐️ wait for cinematic growth
}

function beginCombine(){
  if(combineState.active)return;
  combineState.active=true;
  combineState.phase=0;
  combineState.start=performance.now();
}

combineBtn.addEventListener("click",beginCombine);

/* =========================
   EXISTING BLOBS BUILD
   (unchanged physics omitted here)
   ========================= */

const blobs=[];
ITEMS.forEach((item)=>{
  const wrap=document.createElement("div");
  wrap.className="blob-wrap";
  wrap.style.width="200px";
  wrap.style.height="200px";

  const core=document.createElement("div");
  core.className="blob-core";
  core.style.background=`radial-gradient(circle,${item.color} 0%,transparent 50%)`;

  wrap.appendChild(core);
  stage.appendChild(wrap);

  blobs.push({wrap,core,x:100,y:100});
});

/* =========================
   ANIMATION LOOP
   ========================= */

function animate(now){

if(combineState.active){

  if(combineState.phase===0){

    // ⭐️ pull together — unchanged
    blobs.forEach(o=>{
      o.wrap.style.transform="translate(50vw,50vh)";
    });

    if(now-combineState.start>1600){
      combineState.phase=1;
      combineState.start=now;

      // ⭐️ SLOW COLOR → BLACK MIX
      blobs.forEach(o=>{
        o.core.classList.add("to-black");
      });
    }
  }

  else if(combineState.phase===1){

    // ⭐️ WAIT LONGER so we SEE the mix happen
    if(now-combineState.start>2600){

      combineState.phase=2;

      blobs.forEach(o=>{
        o.wrap.style.transition="opacity 1600ms ease";
        o.wrap.style.opacity="0";
      });

      expandMegaToFill(()=>{
        overlay.classList.add("on");
      });
    }
  }

requestAnimationFrame(animate);
return;
}

requestAnimationFrame(animate);
}

requestAnimationFrame(animate);

})();
</script>

</body>
</html>
